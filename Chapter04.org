#+TITLE: Amplitude Modulation and Vowel Coding in the Stellate Microcircuit
#+AUTHOR: Michael A Eager
#+DATE:
#+OPTIONS: toc:nil H:5 author:nil <:t >:t 
#+STARTUP: oddeven hideblocks fold align hidestars
#+LANGUAGE: en_GB
#+TODO: REFTEX


#+LATEX_HEADER:\graphicspath{{./}{./gfx/}{../SimpleResponsesChapter/gfx/}{../figures/}{/media/data/Work/cnstellate/}{/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/}}
#+LATEX_HEADER:\setcounter{secnumdepth}{5}
#+LATEX_HEADER:\lfoot{\footnotesize\today\ at \thistime}

#+BIBLIOGRAPHY: MyBib alphanat
#+LaTeX_CLASS: UoM-draft-org-article

## Write text after begin { document } 
\setcounter{chapter}{3}
\chapter[AM and Vowel Coding]{Amplitude Modulation and Vowel Coding in the Stellate Microcircuit}

## set global variables for in-code blocks 

* Prelude 							   :noexport:

#+begin_src emacs-lisp results: silent
    (setq org-latex-to-pdf-process '("pdflatex -interaction nonstopmode %f"
    "makeglossaries %b" "bibtex %b" "pdflatex -interaction nonstopmode %f"
    "pdflatex -interaction nonstopmode %f" )) 
   ;; (setq org-latex-to-pdf-process '("xelatex -interaction nonstopmode %f"   "makeglossaries %b" "bibtex %b" "xelatex -interaction nonstopmode %f" "xelatex  -interaction nonstopmode %f" )) 
    (setq org-export-latex-title-command "")  
    (add-to-list 'org-export-latex-classes '("UoM-draft-org-article"
    "\\documentclass[11pt,a4paper,twoside,openright]{book}
    \\usepackage{../hg/manuscript/style/uomthesis}
    \\input{../hg/manuscript/user-defined}
    \\usepackage[acronym]{glossaries}
    \\input{../hg/manuscript/misc/glossary} 
    \\makeglossaries
    \\graphicspath{{./gfx/}} 
    \\pretolerance=150 
    \\tolerance=100
    \\setlength{\\emergencystretch}{3em} 
    \\overfullrule=1mm %
    % \\usepackage[notcite]{showkeys}
    \\lfoot{\\footnotesize\\today\\ at \\thistime}
      [NO-DEFAULT-PACKAGES]
      [NO-PACKAGES]" 
  ("\\clearpage\\newpage\\section{%s}" . "\n\\clearpage\\section{%s}") 
  ("\\subsection{%s}" . "\n\\clearpage\\subsection{%s}") 
  ("\\subsubsection{%s}"  . "\n\\subsubsection{%s}") 
  ("\\paragraph{%s}"  . "\n\\paragraph{%s}") 
  ("\\subparagraph{%s}"  . "\n\\subparagraph{%s}")))
  (setq org-export-latex-title-command "\\singlespacing{\\tableofcontents\\printglossaries}")  
#+end_src

#+RESULTS:
: \singlespacing{\tableofcontents\printglossaries}




* Layout 							   :noexport:	

 | Section                  |          | Pages | Actual | \%TODO/DONE |
 |--------------------------+----------+-------+--------+-------------|
 | Introduction             |          |       |        | [90%]       |
 | Amplitude Modulation     |          |       |        | [50%]       |
 | \quad F0 response        | AN       |       |        |             |
 |                          | CN units |       |        | [95%]       |
 | \quad MTF                | AN       |       |        |             |
 |                          | CN units |       |        |             |
 | Temporal Coding in Vowel |          |       |        | ?           |
 |                          | AN       |       |        |             |
 |                          | CN       |       |        |             |
 | Discussion               |          |       |        |             |
 |--------------------------+----------+-------+--------+-------------|
 |                          | Total    |    20 |        |             |
  #+TBLFM: @19$4=vsum(@3$4..@18$4);


#  \newpage


* Introduction 

This chapter presents the amplitude modulated coding behaviour in a
biophysically-realistic neural network model of the cochlear nucleus. It focuses
specifically on the microcircuit regulating the output of \TS cells.  \TS cells
provide a robust spectral representation of auditory information, and enhanced
coding of temporal information (especially the pitch in complex environments
\citep{KeilsonRichardsEtAl:1997}).  The model contains three inhibitory
interneurons, each controlling the rate and temporal response of \TS cells.
Despite saturation of \TS units on their characteristic frequency, their ability
to code temporal information is not disabled.  The optimal coding of amplitude
modulation is still provided across the network, more specifically in lateral
sidebands around the carrier frequency.


Here we simulate the \AM coding behaviour in a biophysically-realistic neural
network model of the \CN stellate microcircuit (previously discussed in Chapter
3).  \TS cells are the major output of the \CN and provide a robust spectral
representation of auditory information.  \TS cells also show enhanced coding of
temporal information, particularly in the synchronisation to modulation in
speech sounds \citep{BlackburnSachs:1990,KeilsonRichardsEtAl:1997}.  The coding
of \AM in neurons is measured using a \MTF, which is calculated using its firing
rate (\rMTF) or temporal information (\tMTF).



** Temporal Coding in the Auditory Pathway

- Need to expand on why temporal coding is essential
 - voice communication in mammals, birds, frogs etc.
 - summary of work \citep{JorisSchreinerEtAl:2004}
 - eg. Spectral/Rate Coding poor representation of modulated signals
    - mean rate of spikes
    - saturation at high sound level
    - poor \SNR in auditory nerve
  
The coding of \AM in neurons is measured using a \MTF, which is calculated using
its firing rate (\rMTF) or temporal information (\tMTF). The degree of phase
locking is measured by the synchronisation coefficient or vector strength
\citep{GoldbergBrownell:1973,GoldbergBrown:1969}.  The \SI is calculated by
Equation \ref{eq:SI} \cite{JorisSchreinerEtAl:2004}.

# #+BEGIN_LaTeX
# \begin{equation} \label{eq:SI} 
# SI = \frac{1}{N} \sqrt{\left(\sum_{i}^{N} x_i \right)^{2} + \left( \sum_{i}^{N} y_i \right)^{2}}
# \end{equation}
# #+END_LaTeX

# \noindent where $x_{i} = \cos\theta_{i}$, $x_{i} = \sin\theta_{i}$, and /n/ is
# the number of spike times.  Each spike is treated as a vector of unit length and
# with phase $\theta_{i}$ between 0 and $2\pi$ measured as the spike time modulo
# of the stimulus period, $1/f_{m}$.  Perfect synchronisation will give SI = 1,
# whereas values below 0.1 are considered insignificant.  The SI values are
# combined for each modulation frequency to create the \tMTF.  Statistical
# significance of synchronization is usually quantified with the Rayleigh test
# \cite{BuunenRhode:1978,MardiaJupp:1999}. Vector strength and Rayleigh
# coefficient, calculated to verify the statistical significance of
# synchronisation, can also be obtained from the Fourier spectrum of the \PSTH or
# period histogram.
#, in which case it equals the magnitude of the first harmonic, normalised by
# the DC component (average firing rate).  Phase can also be retrieved with
# either technique.  The rate measure (\rMTF) is calculated from the mean firing
# rate in the \PSTH, between 20 ms and the end of the stimulus.

#+LABEL: fig:AMdef
#+ATTR_LaTeX: width=0.8\textwidth
#+CAPTION: [Amplitude modulation and its response in a single auditory nerve fibre]{Amplitude modulated waveform, spectrum and temporal modulation transfer function (tMTF) with low and band-pass functions typical TS cells. BMF: best modulation frequency.  Image reprinted from \citet{JorisSchreinerEtAl:2004}.}
 [[file:../figures/JorisAM_Fig1.png]]

- Variation in sound level
  - poor in \AN (note measurements for f_m at \CF in most studies)
  - enhanced in T stellate cells at high \SPL

#+LABEL: fig:RG94_AN
#+ATTR_LaTeX: width=0.8\textwidth
#+CAPTION: [Temporal response in \ANFs]{Rate and temporal response property of a single \HSR \ANF. Figure reproduced from \citet{RhodeGreenberg:1994}. }
[[file:./gfx/RG94-AN_MTF.png]]

- Variation in modulation frequency
  - definition of \MTF or \tMTF
  - Low-pass to band-pass with high peak in vector strength.
  - Reduced cut-off due to membrane characteristics rather than network effects.

- \citet{JorisSchreinerEtAl:2004} showed the simplified temporal responses from
multiple studies in \ANFs and chopper units (Figure \ref{fig:AMSummary}).

#+BEGIN_LaTeX
  \begin{figure}[htb] \centering
  {\hfill\includegraphics[width=0.45\linewidth,keepaspectratio]{../figures/JorisAM_Fig4A.png}\hfill%
  \includegraphics[width=0.45\linewidth,keepaspectratio]{../figures/JorisAM_Fig4B.png}\hfill}
  \caption{Simplified temporal responses of ANFs and T stellate cells. T stellate
    cells have enhanced synchronisation at high SPL (A) and a band-pass tMTF with
    peaks greater than ANFs (B). Figure reproduced from
    \citet{JorisSchreinerEtAl:2004}.}  \label{fig:AMSummary}
  \end{figure}
#+END_LaTeX

** Existing CN Models' response to AM  

  - Inadequate existing \CN models
  - Zilany \AN model
    - accurate synchronisation behaviour
  - Existing models not realistic
    - Wiegrebe \& Meddis: Point neurons, strong recurrent connections, operate
outside physiological range
    - Bahmer \& Lagner: Point neurons, hypothetical network
    - New \AN model synchronisation behaviour more accurate







* Methods

** Stimulus

Stimulus generation follows Rhode and Greenberg's \citep{RhodeGreenberg:1994}
encoding of amplitude modulation in cats.  \AM signals were generated by
modulating a carrier signal of specified frequency, amplitude, and phase by a
sinusoidal modulator whose amplitude and phase were equal to that of the carrier
(100\% modulation).  Modulation frequency, f_m, ranged from 50 to 800 Hz and was
stepped up by 50 Hz. The carrier frequency was set to the central frequency
channel of the \CN model (5.82 kHz) or to the characteristic frequency of the
different \TS chopper models.

** Simulations

The simulations were performed using the neural simulation package
[[latex:progname][NEURON]] \citep{CarnevaleHines:2006}, as described in Chapter \ref{chp:Methods}. [[latex:progname][NEURON]]'s Crank-Nicholson
integration method was used in the simulations with time step, /dt/ = 0.05 ms,
and total duration 170 ms. Stimuli were repeated 50 times and the spike times of
all \ANF and \CN units recorded.

# ** Output and Data Storage
# \yellownote{What are you doing here}

** Rate and Temporal Analysis in Amplitude Modulation

The rate measure (\rMTF) was calculated from the mean firing rate in the \PSTH,
between 20 ms and the end of the stimulus.

Temporal information was measured using the synchronisation index relative to
the modulation frequency of the stimuli.  Vector strength and Rayleigh
coefficient were also calculated to verify the \SI values using an \FFT of the
period histogram.
# \SI values below 0.1 are considered insignificant.

The temporal measure used to analyse the spike output of an individual neuron
for one \AM stimulus is called the synchronization index or vector strength
\cite{GoldbergBrown:1969}.  The synchronisation index (SI) was calculated 20 ms
after the onset of the stimulus \cite{JorisSchreinerEtAl:2004}, using
Equation \ref{eq:SI}:

#+BEGIN_LaTeX
  \begin{equation}\label{eq:SIb} 
  SI = \frac{1}{N} \cdot \sqrt{\left(\sum_{i=1}^{i=N} x_i \right)^2 + \left(\sum_{i=1}^{i=N} y_i \right)^2 }
  \end{equation}
#+END_LaTeX

\noindent where $x_i = \cos \theta_i$, $x_i = \sin \theta_i$, and $N$ is the
number of spike times.  Each spike is treated as a vector of unit length and
with phase $\theta_i$ between 0 and $2\pi$ measured as the spike time modulo of
the stimulus period, $1/f_m$.  Perfect synchronisation will give \SI = 1,
whereas values below 0.1 are considered insignificant.  The \SI values are
combined for each modulation frequency to create the \tMTF.

# *** The Rayleigh Test

The statistical test used for verifying the
non-uniformity of circular data is the Rayleigh statistic. The Rayleigh statistic is equivalent to a
Chi-squared test for data in uniform data and is calculated using: $2 n R^2$, where /n/ is the
number of spikes and /R/ is the vector strength.  The critical values for the
Rayleigh test are 5.991 for \alpha = 0.05, 9.21 for \alpha = 0.01, and 13.816
for \alpha = 0.001 \citep{Mardia:1972,ShannonZengEtAl:1995,MardiaJupp:1999}. 
The p-values were calculated using the equation:
\begin{equation}\label{eq:p}
\exp(\sqrt{1+4n+4(n^2-R^2)}-(1+2n))
\end{equation}

(Further analysis of
the critical values see W. Rhode's analysis on the vector
strength and Rayleigh statistic [fn::
 [[http://www.neurophys.wisc.edu/comp/docs/not011/not011.html]].] )

#- A more recent study looking at another \SI verification statistic has been
#  published (need to look into this).

# \citep{ChangEtAl:}


* Results 

** ISSNIP results

- Note the responses in the ISSNIP data was simulated with the early Bruce model
  and the \TS parameters were just the default values (equivalent to the \CS
  model)

The figures below show the rate and temporal responses, across the entire
network, to an \AM tone with carrier frequency equal to the central channel's
characteristic frequency (5.82 kHz).  Modulation frequency ranged from 50 to 800
Hz.  Each figure shows the mean firing rate on the left and the synchronisation
index on the right.  The sound level of each stimulus was set to 40 dB \SPL for
the top row and 60 dB \SPL for the bottom row.

*** ANF Model Results: ANF Responses to Sinusoidal Amplitude Modulation

 - High \SR fibres at 60 dB \SPL

#+BEGIN_LaTeX
  \begin{figure}[thb] 
    \centering
    {\hfill{ Rate (sp/s)\hfill Temporal}}\\
    \resizebox{\columnwidth}{!}{{\Huge 60 dB}\raisebox{-0.5\height}{\includegraphics{60/ratetemporal-4.png}}}\\
    \caption{Rate and temporal modulation transfer functions (MTF) of HSR auditory
      nerve fibres at 60 dB SPL.}  \label{fig:ANMTF}
  \end{figure}
#+END_LaTeX

*** GLG Model Results: Golgi Cells to Sinusoidal Amplitude Modulation

#+BEGIN_LaTeX
  \begin{figure}[tb] 
    \centering %\caption{GLG Rate (spks/s) and SI 60 dB}
  %{\hspace{0.2\columnwidth}rMTF (sp/s) \hspace{0.35\columnwidth} tMTF}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{40/ratetemporal-3.eps}}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{60/ratetemporal-3.eps}}
    {\hfill{ Rate (sp/s)\hfill Temporal}}\\ 
    \resizebox{\columnwidth}{!}{{\Huge 40 dB}\raisebox{-0.5\height}{\includegraphics{40/ratetemporal-3.png}}}\\ 
    \resizebox{\columnwidth}{!}{{\Huge 60 dB}\raisebox{-0.5\height}{\includegraphics{60/ratetemporal-3.png}}}
    \caption{Golgi cell rate (rMTF) and temporal (tMTF) responses for stimulus sound
      levels 40 dB SPL (top row) and 60 dB SPL (bottom row).}\label{fig:G}
  \end{figure}
#+END_LaTeX

Figure \ref{fig:G} shows the rate and temporal \MTF across the whole network to
AM tone centred at channel 50. The Golgi units had very low rates for 40 and 60
dB \SPL \AM tones which were limited to a narrow range around the central
channel.  The temporal response of Golgi units was almost non-existent except
for very low modulation.

*** DS Model Results: D Stellate Cells to Sinusoidal Amplitude Modulation

#+BEGIN_LaTeX
  \begin{figure}[tb] 
  \centering %{\hspace{0.2\columnwidth}rMTF (sp/s) \hspace{0.35\columnwidth} tMTF}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{40/ratetemporal-2.eps}}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{60/ratetemporal-2.eps}}
  {\hfill{ Rate (sp/s)\hfill Temporal}}\\ 
  \resizebox{\columnwidth}{!}{{\Huge 40 dB}\raisebox{-0.5\height}{\includegraphics{40/ratetemporal-2.png}}}\\ 
  \resizebox{\columnwidth}{!}{{\Huge 60 dB}\raisebox{-0.5\height}{\includegraphics{60/ratetemporal-2.png}}}
  \caption{DS cell rate (rMTF) and temporal (tMTF) responses for stimulus sound
    levels 40 dB SPL (top row) and 60 dB SPL (bottom row).}\label{fig:DS}
  \end{figure}
#+END_LaTeX

The broad range of \CF inputs to \DS units allow for a greater likelihood of
coincident detection and an increase in synchronisation relative to the inputs.
The rate responses of \DS units (Figure \ref{fig:DS}) were wider for 40 and 60
\SPL stimuli relative to the narrow band \TS units.  For 40 dB \SPL stimuli,
most \DS units had a band-pass \rMTF.  For higher \SPL, a greater number of
spikes occured between 100 and 500 Hz for units above \CF (band-pass \rMTF), but
the rest of the active units remained stable (low-pass \rMTF). This
``rate-responder'' behaviour is similar in ideal onset units in the \VCN
(octopus cells) but the cut-off of the \rMTF is much lower. The temporal
responses of \DS units were predominantly band-pass, with higher \SI values than
\ANFs.  For lower \SPL, the responses were consistent across active units with a
falling cut-off frequency with falling \CF.  For high \SPL, the \DS units were
divided along the central channel.  The \DS units above the central channel had
the strongest synchronisation and cut-off frequencies near the upper limit of
the \AN model.  The \DS units below the central channel had cut-off frequencies
around 400 Hz, similar to \TS and \TV units.

*Notes*
 - "Rate-responder" \MTF characteristics
 - Enhanced low-pass temporal \MTF
   - Near perfect synchronisation
 - Level dependent
   - Wide-band onset inhibitor
   - Golgi input suppresses saturated \AN input and provides a sustained a-phasic input of \GABA inhibition

*** TV Model Results: Tuberculoventral Cell Responses to Sinusoidal Amplitude Modulation

#+BEGIN_LaTeX
  \begin{figure}[tb] 
  \centering 
  %\caption{TV Rate (spks/s) and SI 60 dB}
  %{\hspace{0.2\columnwidth}rMTF (sp/s) \hspace{0.35\columnwidth} tMTF}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{40/ratetemporal-1.eps}}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{60/ratetemporal-1.eps}}
  {\hfill{ Rate (sp/s)\hfill Temporal}}\\ 
  \resizebox{\columnwidth}{!}{{\Huge 40 dB}\raisebox{-0.5\height}{\includegraphics{40/ratetemporal-1.png}}}\\ 
  \resizebox{\columnwidth}{!}{{\Huge 60 dB}\raisebox{-0.5\height}{\includegraphics{60/ratetemporal-1.png}}}
  \caption{TV cell rate (rMTF) and temporal (tMTF) responses for stimulus sound
  levels 40 dB SPL (top row) and 60 dB SPL (bottom row).}\label{fig:TV}
  \end{figure}
#+END_LaTeX

The rate and temporal responses of \TV units (Figure \ref{fig:TV}) showed the
non-linear effects of strong inhibition from \DS units. \TS and \TV units
received similar \ANF inputs, but the inhibition limited the activity at low
sound level and then to a narrow range at higher \SPL.  The temporal responses
of \TV units were similar to \TS units but with lesser synchronisation and
sharper cut-off.  The outer edges of active units provided the best temporal
response with little to no temporal information at the carrier frequency units.

*Notes*
 - Low rate
    - Strong \DS inhibition
 - Moderate synchronisation
    - \DS inhibition phasic
 - Level dependent

\clearpage
*** TS Model Results: T Stellate Cell Responses to Sinusoidal Amplitude Modulation

*Note* this section was simulated with default \TS parameters, see new data for optimised Chopper parameters
  
#+BEGIN_LaTeX
  \begin{figure}[tb] 
  \centering %\caption{TS Rate (spks/s) and SI 60 dB}
  %{\hspace{0.2\columnwidth}rMTF (sp/s) \hspace{0.35\columnwidth}tMTF}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{40/ratetemporal-0.eps}}\\ 
  %\resizebox{0.95\columnwidth}{!}{\includegraphics{60/ratetemporal-0.eps}}
  {\hfill{ Rate (sp/s)\hfill Temporal}}\\ 
  \resizebox{\columnwidth}{!}{{\Huge 40 dB}\raisebox{-0.5\height}{\includegraphics{40/ratetemporal-0.png}}}\\ 
  \resizebox{\columnwidth}{!}{{\Huge 60 dB}\raisebox{-0.5\height}{\includegraphics{60/ratetemporal-0.png}}}
  \caption{TS cell rate (rMTF) and temporal (tMTF) responses for stimulus sound
    levels 40 dB SPL (top row) and 60 dB SPL (bottom row).}
  \label{fig:TS}
  \end{figure}
#+END_LaTeX

Figure \ref{fig:TS} shows the final \MTF response of the \TS units in the
network.  The spread of excitation in \TS units was narrow around the central
channel, with greater excitation above \CF around fm=300 Hz. For higher sound
levels, the spread of excitation was wider but the rate was steadier for each
stimuli.  The significant features of the temporal responses in the right of the
figure are the very poor synchronisation in the central channel and dominant
synchronous responses at the outer edge of excitation.  For 40 dB \SPL, most
active units showed a band-pass \MTF; however, the dominant units above \CF
(channels 55 to 58) had low-pass \MTFs.  For 60 dB \SPL, most active units
showed band-pass \MTFs except for the central units, which showed limited
results or a low-pass \MTF.  Outermost active units (channels 65 to 60 and 45
to 40) had the most dominant temporal response across the \TS cell population.

- Notes
 - Sustained chopper level independent
   - \AM rate saturation of \TS units on \CF does not disable their ability to
     encode temporal information
 - Band-pass synchronisation
   - enhancement off-CF
 - Effects of inhibition
   - \DS : phasic inhibition
   - Golgi : slow level dependent
   - \TV : delayed echo suppression 



\clearpage
** New Data

- The following results were simulated with the newest Zilany \AN model with a
Cat compression audiogram
- The f_c was simulated at three values corresponding to the \CF of the chopper
optimisation models

*** F_0 Response: Variation in Level

- The f_0 response is the behaviour characterised in
\citet{ZilanyBruceEtAl:2009} to describe the variation in sound pressure level
where the f_c is fixed at the \CF of the unit.

#+LABEL: fig:F0_Rayexample
#+ATTR_LaTeX: width=0.9\linewidth
#+CAPTION: [Rayleigh test of $F_0$ response in HSR units]{Rayleigh test of $F_0$ response in HSR units at 150 Hz (a) with accompanying mask for statistically significant values (b).  The method for improved presentation of vector strength plots for units in the stellate microcircuit uses the mask in (b).  Amplitude modulated tones at carrier frequency 8.9 kHz and modulated frequency of 150 Hz were presented from 0 to 70 db SPL ( increments of 5 dB SPL).}
#+RESULTS: F0_Rayexample
[[file:./gfx/F0_Rayexample.png]]


#+LABEL: fig:F0_Rayexample2
#+ATTR_LaTeX: width=0.9\linewidth
#+CAPTION: Example Rayleigh test of F0 response in HSR units
#+RESULTS: F0_Rayexample2
[[file:./gfx/F0_Rayexample2.png]]


Figure \ref{fig:MTFexample} demonstrates the method for removing noise in the
vector strength plots using a mask.

#+LABEL: fig:MTFexample
#+ATTR_LaTeX: width=0.9\linewidth
#+CAPTION: Method for improved presentation of vector strength in the stellate microcircuit.  Amplitude modulated tones at  MTF of the 6 units at 20 db SPL (top), 40 dB, 60 dB SPL.
#+RESULTS: MTF_example
[[file:./gfx/MTF_example.png]]

**** TODO Auditory Nerve units

#+ATTR_LaTeX: width=0.9\linewidth
#+CAPTION: PDTH response in auditory nerve fibres
#+LABEL: fig:ANpsth
#+RESULTS: AN_psth
[[file:./gfx/AN_psth.png]]


#+LABEL: fig:anf0
#+ATTR_LaTeX: width=0.9\linewidth
#+CAPTION: F_0 response in auditory nerve fibres
[[file:./gfx/AN_f0.png]]

**** Cochlear Nucleus units

**** Golgi, DS and TV cell responses to AM 

TODO show AN Golgi DS and TV in one plot then do the choppers in the next
section


***** Chopper Sustained model: Low Freq (3.9 kHz)

#+LABEL: fig:F0ResponseCS
#+CAPTION: F_0 response of all 6 units at high carrier frequency (8.2 kHz). TS uses CT1 optimised model configuration.
#+RESULTS: TStellate_CS_F0Response
[[file:./gfx/TStellate_CS_F0Response.png]]

***** Chopper Transient 1: Mid Freq (8.2 kHz)

#+LABEL: fig:F0ResponseCT1
#+CAPTION: F_0 response of all 6 units at high carrier frequency (8.2 kHz). TS uses CT1 optimised model configuration.
#+RESULTS: TStellate_CT1_F0Response
[[file:./gfx/TStellate_CT1_F0Response.png]]

***** Chopper Transient 2 model: High Freq (12.9 kHz)

#+LABEL: fig:F0ResponseCT2
#+CAPTION: F_0 response of all 6 units at high carrier frequency (12.9 kHz). TS uses CT2 optimised model
#+RESULTS: TStellate_CT2_F0Response
[[file:./gfx/TStellate_CT2_F0Response.png]]



\clearpage


*** Modulation Transfer Function


#+CAPTION:  MTF of the 6 units at 20 db SPL (top), 40 dB, 60 dB, and 80 dB (bottom). Low freq $f_m$ (3.9 kHz) and CS optimised parameters for the TS model.
#+ATTR_LaTeX: width=0.9\linewidth
#+LABEL: fig:CSMTF
#+RESULTS: TStellate_CS_MTF
[[file:./gfx/TStellate_CS_MTF.png]]


#+CAPTION:  MTF of the 6 units at 20 db SPL (top), 40 dB, 60 dB, and 80 dB (bottom). Med freq f_m and CT1 model.
#+ATTR_LaTeX: width=0.9\linewidth
#+LABEL: fig:CT1MTF
#+RESULTS: TStellate_CT1_MTF
[[file:./gfx/TStellate_CT1_MTF.png]]


#+CAPTION:  MTF of the 6 units at 20 db SPL (top), 40 dB, 60 dB, and 80 dB (bottom). High freq f_m and CT2 model.
#+ATTR_LaTeX: width=0.9\linewidth
#+LABEL: fig:CT2MTF
#+RESULTS: TStellate_CT2_MTF
[[file:./gfx/TStellate_CT2_MTF.png]]

\clearpage

**** Gnuplot versions

#+LABEL: fig:CSMTF
#+ATTR_LaTeX: width=0.95\linewidth
#+CAPTION:    AM coding in stellate microcircuit: CS parameters
#+RESULTS: CS_MTF
[[file:./gfx/CS_MTF.png]]


#+LABEL: fig:CT1MTF
#+ATTR_LaTeX: width=0.95\linewidth
#+CAPTION:    AM coding in stellate microcircuit: CT1 parameters
#+RESULTS: CS_MTF
[[file:./gfx/CT1_MTF.png]]


#+LABEL: fig:CT2MTF
#+ATTR_LaTeX: width=0.95\linewidth
#+CAPTION:    AM coding in stellate microcircuit: CT2 parameters
#+RESULTS: CS_MTF
[[file:./gfx/CT2_MTF.png]]


* Discussion


Golgi cells are low-firing monotonic units that influence the general
excitability of \DS and \TS units using \GABA.  The results in Figure
\ref{fig:GLG_AM} show that the rate response to \AM tones is only dependent on
the sound level. The temporal response of the Golgi cell model is negligible.




The rate and temporal response of \TV cells was strongly inhibited by \DS units.
TV cells are thought to be responsible for delayed inhibition or
echo-suppression \citep{WickesbergOertel:1990}, but can also be involved in
tuning the temporal \MTF behaviour in \TS cells.




D stellate cells have an onset chopping behaviour to tones, but can follow the
repetition of amplitude modulated tones. The entrainment to the stimulus
envelope produced band-pass rate \MTFs in \DS units with a \CF above $f_c$.  The
temporal information at the channel with \CF=$f_c$ (Figure \ref{fig:DS}) was
diminished by the strong \GABAergic inhibition of Golgi cells; however, the
majority of active \DS units showed strong synchronisation, which suggests
synchronous tuning in \TV and \TS units throughout the \CN.


The inhomogeneous population of \TS cells are classified into different
subgroups, namely sustained or transient choppers.  Intrinsic membrane
properties and synaptic connections enable \TS units to be enhanced or tuned to
important features of the acoustic input \citep{PaoliniClareyEtAl:2005}. The
behaviour of \TS units is influenced by all three interneurons in the stellate
microcircuit.


\AM rate saturation of \TS units on \CF (Figure \ref{fig:TS}) does not disable
their ability to encode temporal information.  Experimental data has shown \TS
cells generally have low-pass \MTF at low sound level and band-pass \MTF for
higher sound levels for \AM tones on \CF \citep{RhodeGreenberg:1994}.  The
implications for the \AM coding in \TS output on higher-order auditory centres
have been investigated but not fully understood
\citep{WiegrebeMeddis:2004,BahmerLangner:2006a}. A whole-network approach may
provide a stronger basis for optimal temporal coding of \AM than an approach
based solely on \CF.


* Conclusion

The \CN stellate microcircuit provides controlled and modulated enhancement of
the output of \TS cells, one of the major outputs of the cochlear nucleus.  This
paper has demonstrated the need to model detailed neural microcircuits away from
basic receptive fields of individual units.  The model has been used for
detailed optimisation \citep{EagerGraydenEtAl:2006,EagerGraydenEtAl:2007a} so
that it can be used to investigate detailed physiological properties in the \CN
stellate network.

 - Transition from temporal to rate coding in auditory pathway
 - Stellate microcircuit provides controlled and enhanced output of \TS cells
 - \AM representation in lateral sidebands essential

 - Exploration of the \CN stellate microcircuit
 - Spectral/Rate representation in speech and speech in noise
   - lateral inhibition
   - neuromodulation
 - Temporal representation
   - enhancement of \SNR relative to individual \ANFs
   - period-tagging linked to multiple auditory streams


## BIBLIOGRAPHY
\newpage \singlespacing \bibliographystyle{plainnat} 
\bibliography{MyBib}
\newpage\listoftodos
## BIBLIOGRAPHY

# * Figures 							   :noexport:

# ** ISSNIP

# # #+name localdatapath
# # #+BEGIN_SRC gnuplot :export none
# # localpath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/"
# # do for [level in "40 60"] {
# #  do for [celltype in "0 1 2 3"] {
# #    filename_ = "./".level."./ratetemporal-".celltype.".png" 
# #    ratetemporal(filename=filename_,INDEX=celltype,SPL=level,datapath=localpath)
# #  }
# # }

# # #+END_SRC

# # #+RESULTS:


# #+name: ratetemporal
# #+header: :term pngcairo size 700,524 enhanced font 'Verdana,10' 
# #+BEGIN_SRC gnuplot :export none 
# reset if (INDEX == "" || SPL == "") { unset output; quit} set xlabel "f_m (Hz)"
# font "Helvetica,16" set ylabel "Channel Position" font "Helvetica,16"
# set pm3d map
# #set logscale x 10
# set colorbox noborder set multiplot layout 1,2 set xtics out ( "100" 100, ""
# 200, "300" 300, "" 400, "500" 500, "" 600, "700" 700, "" 800) unset key
# #set logscale y 10
# set cbrange [0:400]
# #set palette model RGB
# #set palette defined
# #set palette defined (0 "blue", 150 "white", 300 "red")
# set palette rgbformulae 22,13,-31

# splot [50:800][0:99] datapath.spl.'response_area.'.INDEX.'.dat' u 1:2:($4*5)
# #unset palette
# unset ylabel unset logscale y set cbrange [0:1]
# #set palette model HSV rgbformulae 3,2,2
# #set palette model XYZ rgbformulae 7,5,15
# #set palette defined ( 0 0 0 0, 1 1 1 1 )
# set palette rgbformulae 7,5,15 splot [50:800][0:99]
# datapath.spl.'vsSPIKES.'.INDEX.'.dat' matrix u ($1*50+50):2:3 unset multiplot
# #+END_SRC

# *** fig:ANMTF

# #+call: ratetemporal[ :file ./60/ratetemporal-4.png ](spl="60/",INDEX=4,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none 

# *** fig:G

# #+call: ratetemporal[ :file ./40/ratetemporal-3.png ](spl="40/",INDEX=3,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none
# #+call: ratetemporal[ :file ./60/ratetemporal-3.png ](spl="60/",INDEX=3,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none 

# *** fig:DS

# #+call: ratetemporal[ :file ./40/ratetemporal-2.png ](spl="40/",INDEX=2,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none
# #+call: ratetemporal[ :file ./60/ratetemporal-2.png ](spl="60/",INDEX=2,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none 

# *** fig:TV

# #+call: ratetemporal[ :file ./40/ratetemporal-1.png ](spl="40/",INDEX=1,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none
# #+call: ratetemporal[ :file ./60/ratetemporal-1.png ](spl="60/",INDEX=1,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none 

# *** fig:TS

# #+call: ratetemporal[ :file ./40/ratetemporal-0.png ](spl="40/",INDEX=0,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none
# #+call: ratetemporal[ :file ./60/ratetemporal-0.png ](spl="60/",INDEX=0,datapath="/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/") :results none :export none 



# # ** F_0 Response: Variation in Level

# # - The f_0 response is the behaviour characterised in
# # \citet{ZilanyBruceEtAl:2009} to describe the variation in sound pressure level
# # where the f_c is fixed at the \CF of the unit.

# # #+NAME: F0_Rayexample
# # #+begin_src octave :exports none :results file

# # # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/F0Response/";
# # # # vs = /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/F0Response/vsSPIKES.4.dat;
# # # # ray = /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/F0Response/rayltest.4.dat;
# # #   vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]);
# # #   ray = load([datapath "rayltest." num2str(ii) ".dat"]);
# # #   maskray1 = (13.816- 9.210) * (ray > 13.816) + (9.210-5.991) * (ray > 9.210) + 5.991*(ray > 5.991);
# # #  significant = ray > 13.816;
# # #  z0 = significant .* vs;
# # #  cmap1 = hot(); cmap2=jet();
# # #  cmap=[cmap1(64:-1:1,:);];# cmap2]; # inverse of hot and jet combined
# # #  colormap(cmap);
# # #  subplot(2,2,1);
# # #  surf([0:99],[0:5:70],ray');
# # #  set(gca,"ZLabel","Rayleigh Test", "XLabel", "Network Channel", "YLabel", "Sound Level (dB SPL)");
# # #  subplot(1,2,2);
# # #  surf([0:99],[0:5:70],maskray1',"EdgeColor",'none','LineStyle','none','FaceLighting','phong'); view(2);
# # #  set(gca,"XLabel", "Network Channel", "YLabel", "Sound Level (dB SPL)");

# # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/F0Response/";
# # ii = 4 vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]); ray =
# # load([datapath "rayltest." num2str(ii) ".dat"]); maskray1 = (13.816- 9.210) *
# # (ray > 13.816) + (9.210-5.991) * (ray > 9.210) + 5.991*(ray > 5.991);
# # significant = ray > 13.816; z0 = significant .* vs; subplot(2,2,3);
# # surf([0:99],[0:5:70],vs',"EdgeColor",'none','LineStyle','none','FaceLighting','phong');
# # view(2); set(gca,"XLabel", "Network Channel", "YLabel", "Sound Level (dB SPL)");
# # subplot(2,2,4); surf([0:99],[0:5:70],(z0 +
# # max(ray(:)))',"EdgeColor",'none','LineStyle','none','FaceLighting','phong');
# # view(2); set(gca,"XLabel", "Network Channel", "YLabel", "Sound Level (dB SPL)");
# #  # ## Set CLim on both axes
# #  # ax = findobj(gcf,'Type','axes');
# #  # set(ax,'CLim', [min(ray(:)) max(ray(:)+z0(:))])
# #  print -dpng "gfx/F0_Rayexample.png" ans = "./gfx/F0_Rayexample.png"
# # #+end_src


# # #+name: F0_Rayexample2
# # #+begin_src octave :exports none :results file
# # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/F0Response/";
# # #datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/F0Response/";
# # ii = 4 vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]); ray =
# #   load([datapath "rayltest." num2str(ii) ".dat"]); maskray1 = (13.816- 9.210) *
# #   (ray > 13.816) + (9.210-5.991) * (ray > 9.210) + 5.991*(ray > 5.991);
# #   significant = ray > 13.816; z0 = significant .* vs; cmap1 = hot();
# #   cmap2=jet(); cmap=[cmap1(64:-1:1,:);];# cmap2]; # inverse of hot and jet
# #   combined colormap(cmap); subplot(2,2,1); surf([0:99],[0:5:70],ray');
# #   set(gca,"ZLabel","Rayleigh Test", "XLabel", "Network Channel", "YLabel",
# #   "Sound Level (dB SPL)"); subplot(1,2,2);
# #   surf([0:99],[0:5:70],maskray1',"EdgeColor",'none','LineStyle','none','FaceLighting','phong');
# #   view(2); set(gca,"XLabel", "Network Channel", "YLabel", "Sound Level (dB
# #   SPL)");

# # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/F0Response/";
# # ii = 4 vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]); ray =
# # load([datapath "rayltest." num2str(ii) ".dat"]); maskray1 = (13.816- 9.210) *
# # (ray > 13.816) + (9.210-5.991) * (ray > 9.210) + 5.991*(ray > 5.991);
# # significant = ray > 13.816; z0 = significant .* vs; subplot(2,2,3);
# # surf([0:99],[0:5:70],(vs +
# # max(ray(:)))',"EdgeColor",'none','LineStyle','none','FaceLighting','phong');
# # view(2); set(gca,"XLabel", "Network Channel", "YLabel", "Sound Level (dB SPL)");
# # subplot(2,2,4); surf([0:99],[0:5:70],(z0 +
# # max(ray(:)))',"EdgeColor",'none','LineStyle','none','FaceLighting','phong');
# # view(2); set(gca,"XLabel", "Network Channel", "YLabel", "Sound Level (dB SPL)");
# #  # ## Set CLim on both axes
# #  # ax = findobj(gcf,'Type','axes');
# #  # set(ax,'CLim', [min(ray(:)) max(ray(:)+z0(:))])
# #  print -dpng "gfx/F0_Rayexample2.png" ans = "./gfx/F0_Rayexample2.png"
# # #+end_src

# # *** Auditory Nerve units

# # #+name: AN_psth
# # #+begin_src gnuplot :exports none :file ./gfx/AN_psth.png :term pngcairo size 700,524 enhanced font 'Verdana,10'
# #       reset
# #   #    load '/media/data/Work/cnstellate/ResponsesNoComp/default.gnu'
      
# #       # set term pngcairo size 350,262 enhanced font 'Verdana,10'
# #       # set output "gfx/AN_f0.png"
      
# #       # Margins for each row resp. column
# #   #    TMARGIN = "set tmargin at screen 0.90; set bmargin at screen 0.55"
# #   ##    BMARGIN = "set tmargin at screen 0.55; set bmargin at screen 0.20"
# #   #    LMARGIN = "set lmargin at screen 0.15; set rmargin at screen 0.55"
# #   #    RMARGIN = "set lmargin at screen 0.55; set rmargin at screen 0.95"
      
# #     #  set tics scale 0.5
# #     #  set ytics 1
# #       # Placement of the a,b,c,d labels in the graphs
# #       POS = "at graph 0.92,0.9 font ',16' "
# #   #    unset key
# #       # x- and ytics for each row resp. column
# #   #    NOXTICS = "set xtics ('' 100,'' 200,'' 300,'' 400,'' 500,'' 600,'' 700,'' 800); \
# #   #              unset xlabel"
# #   #    XTICS = "set xtics 100,100,800;\
# #   #              set xlabel 'Mod Freq (Hz)'"
# #   #    NOYTICS = "set format y ''; unset ylabel"
# #   #    YTICS = "set format y '%.0f'; set ylabel 'Channel No.'"
# #       unset key set multiplot layout 2, 2
# #       # set pm3d map
# #       # set palette @JET
# #       # set zrange [0:1]
# #       # set cbrange [0:1]
# #       # --- GRAPH a
# #       # @NOXTICS; @YTICS
# #       # @TMARGIN; @LMARGIN
# #        set label 1 'A' @POS
# #       # splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:3
# #       set xtics nomirror out set border 3 set boxwidth 1.0 relative set style
# #       fill transparent solid 0.8 set ylabel "Spikes" unset xlabel plot
# #       [-0.5:10.5] "<awk '/^50/ {print $2,$3}'
# #       /media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/100/periodhist.0.dat"
# #       using 1:2 w boxes lc 'black'
    
    
      
# #       # # --- GRAPH b
# #       #  @NOXTICS; @NOYTICS
# #     #    @TMARGIN; @RMARGIN
# #     set ylabel "Channel No." font "Helvetica,14" set xlabel "Fm (Hz)" font
# #     "Helvetica,14" set label 1 'B' @POS textcolor rgb #FFFFFF set pm3d map set
# #     logscale x 10 splot [50:800]
# #     "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/ratetemporal.0.dat"
# #     matrix using ($1*50):2:3 unset pm3d unset logscale x
    
# #       #  # --- GRAPH c
# #       #  @XTICS; @YTICS
# #       #  @BMARGIN; @LMARGIN
# #       set label 1 'C' @POS
# #       #  splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:3
# #       set ylabel "Spikes" set xlabel "Time (ms)" plot [0:270] "<awk '/^50/
# #       {print $2,$3}'
# #       /media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/100/psth.0.dat"
# #       using 1:2 w boxes lc 'black'
      
# #       #  # --- GRAPH d
# #       #  @XTICS; @NOYTICS
# #       #  @BMARGIN; @RMARGIN
  
# #     set ylabel "Channel No." font "Helvetica,14" set xlabel "Fm (Hz)" font
# #     "Helvetica,14" set label 1 'D' @POS textcolor rgb #FFFFFF set pm3d map set
# #     logscale x 10 splot [50:800]
# #     "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.0.dat"
# #     matrix using ($1*50):2:3 unset pm3d unset logscale x
  
# #       #  splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.5.dat" matrix using ($1*50):2:3
      
# #     # plot '< tail -1| head -50 /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.4.dat'  using 
# #      unset multiplot
     
# #     #  plot "< ls -rt /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/vsSPIKES.5.dat| xargs awk '/^50\t/ {print $2, $3}' " u (($0+1)*50):1 w l'
# #     #  plot "< ls -rt /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/vsSPIKES.4.dat| xargs awk '/^50\t/ {print $2}' "  w l
    
# #     # set multiplot 2,2
# #     # set xtics nomirror out
# #     # set boxwidth 1.0 relative
# #     # set style fill transparent solid 0.8 
# #     # set ylabel "Spikes"
# #     # set xlabel "Time (ms)"
    
# #     # plot [-0.5:10.5] "<awk '/^50/ {print $2,$3}' /media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/100/periodhist.0.dat" using 1:2  w boxes lc 'black'
    
# #   #  plot [0:270] "<awk '/^50/ {print $2,$3}' /media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/100/psth.0.dat" using 1:2  w boxes lc 'black'
    
    
# #     # plot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/250/rateplace.1.dat" using 1:3 w l 
# # #+end_src

# # #+name: AN_F0
# # #+begin_src gnuplot :exports none :file ./gfx/AN_f0.png :term pngcairo size 700,524 enhanced font 'Verdana,10'
# #     reset load '/media/data/Work/cnstellate/ResponsesNoComp/default.gnu'
    
# #     # set term pngcairo size 350,262 enhanced font 'Verdana,10'
# #     # set output "gfx/AN_f0.png"
    
# #     # Margins for each row resp. column
# #     TMARGIN = "set tmargin at screen 0.90; set bmargin at screen 0.55" BMARGIN =
# #     "set tmargin at screen 0.55; set bmargin at screen 0.20" LMARGIN = "set
# #     lmargin at screen 0.15; set rmargin at screen 0.55" RMARGIN = "set lmargin
# #     at screen 0.55; set rmargin at screen 0.95"
    
# #   #  set tics scale 0.5
# #   #  set ytics 1
# #     # Placement of the a,b,c,d labels in the graphs
# #     POS = "at graph 0.92,0.9 font ',16' " unset key
# #     # x- and ytics for each row resp. column
# #     NOXTICS = "set xtics ('' 100,'' 200,'' 300,'' 400,'' 500,'' 600,'' 700,''
# #               800); \ unset xlabel" XTICS = "set xtics 100,100,800;\ set xlabel
# #               'Mod Freq (Hz)'" NOYTICS = "set format y ''; unset ylabel" YTICS =
# #               "set format y '%.0f'; set ylabel 'Channel No.'"
    
# #     # set multiplot layout 2,1
# #     # set pm3d map
# #     # set palette @JET
# #     # set zrange [0:1]
# #     # set cbrange [0:1]
# #     # # --- GRAPH a
# #     # @NOXTICS; @YTICS
# #     # @TMARGIN; @LMARGIN
# #     # set label 1 'A' @POS
# #     # splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:3
    
# #     # # # --- GRAPH b
# #     # # @NOXTICS; @NOYTICS
# #     # # @TMARGIN; @RMARGIN
# #     # # set label 1 'B' @POS
# #     # # splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.5.dat" matrix using ($1*50):2:3
    
# #     #  # --- GRAPH c
# #     #  @XTICS; @YTICS
# #     #  @BMARGIN; @LMARGIN
# #     #  set label 1 'C' @POS
# #     #  splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:3
    
# #     #  # --- GRAPH d
# #     #  @XTICS; @NOYTICS
# #     #  @BMARGIN; @RMARGIN
# #     #  set label 1 'd' @POS
# #     #  splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.5.dat" matrix using ($1*50):2:3
    
# #   # plot '< tail -1| head -50 /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.4.dat'  using 
# #   #  set multiplot 3,1
  
# #   #  plot "< ls -rt /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/vsSPIKES.5.dat| xargs awk '/^50\t/ {print $2, $3}' " u (($0+1)*50):1 w l
# #   #  plot "< ls -rt /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/vsSPIKES.4.dat| xargs awk '/^50\t/ {print $2}' "  w l
  
    
# #     # "ls -rt /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/rateplace.0.dat | xargs awk '/^50\t/ {print $3}'" u (50*$1)
  
# #     set multiplot layout 2,1 set size 0.89,0.3 set origin 0,0.7 set border 2 set
# #     ytics nomirror out set logscale x 10 set xrange [40:1500] set xtics nomirror
# #     out
# #   #  unset xtics
# #     unset xlabel set ylabel "Firing Rate (sp/s)" font "Helvetica,14" plot "< ls
# #     -rt
# #     /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/rateplace.0.dat |
# #     xargs awk '/^50\t/ {print $3}'" u (($0+1)*50):(10*$1) t "Rate" w l
  
# #     set border 11 set size 1,0.7 set origin 0,0
    
# #     set ytics nomirror out set y2tics nomirror out set xtics nomirror out set
# #     yrange [0:1] set logscale x 10 set logscale y2 10 set xrange [40:1500] set
# #     xlabel "Modulation Frequency (Hz)" font "Helvetica,14" set y2label "Rayleigh
# #     Test" font "Helvetica,14" set ylabel "Vector Strength" font "Helvetica,14"
# #     set key on inside top right
  
# #     set arrow 1 from 300,13 to 1400,13 nohead set arrow 1 from 300,5 to 1400,5
# #     nohead
    
# #     plot "< ls -rt
# #     /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/vsSPIKES.0.dat|
# #     xargs awk '/^50\t/ {print $2, $3}' " u (($0+1)*50):1 t "VS" w l lw 4 axes
# #     x1y1, \ "< ls -rt
# #     /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/vsSPIKES.0.dat|
# #     xargs awk '/^50\t/ {print $2, $3}' " u (($0+1)*50):2 t "RayleighTest " w l
# #     axes x1y2
# #     #
# #   # "< ls -rt /media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/*/rateplace.0.dat | xargs awk '/^50\t/ {print $3}'" u (($0+1)*50):(10*$1) t "Rate" w l axes x1y2
  
# #     unset multiplot
# # #+END_SRC

# # *** Cochlear Nucleus units

# # **** Chopper Sustained model: Low Freq (3.9 kHz)


# # #+name:TStellate_CS_F0Response
# # #+begin_src octave :exports none :results file
# # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/F0Response/"
# # for ii = 0:5 vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]); ray =
# # load([datapath "rayltest." num2str(ii) ".dat"]); significant = ray > 5.991; z0 =
# # significant .* vs; subplot(3,2,ii+1) imagesc([0:99],0:5:70,z0', [0
# # 1]);axis("xy") end

# # # xlim([30 60]);
# #  set( get(gcf,'children')(2),"xlabel" ," Channel No.", "ylabel", " Level (dB
# #  SPL)" )

# #  print -dpng "gfx/TStellate_CS_F0Response.png" ans =
# #  "gfx/TStellate_CS_F0Response.png"
# # #+end_src

# # #+LABEL: fig:F0ResponseCS
# # #+CAPTION: F_0 response of all 6 units at high carrier frequency (8.2 kHz). TS uses CT1 optimised model configuration.
# # [[file:./gfx/TStellate_CS_F0Response.png]]

# # **** Chopper Transient 1: Mid Freq (8.2 kHz)

# # #+name: TStellate_CT1_F0Response
# # #+begin_src octave :exports none  :results file
# # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CT1/F0Response/"
# # for ii = 0:5 vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]); ray =
# # load([datapath "rayltest." num2str(ii) ".dat"]); significant = ray > 5.991; z0 =
# # significant .* vs; subplot(3,2,ii+1) imagesc([0:99],0:5:70,z0', [0
# # 1]);axis("xy") end

# # # xlim([30 60]);
# #  set( get(gcf,'children')(2),"xlabel" ," Channel No.", "ylabel", " Level (dB
# #  SPL)" )

# #  print -dpng "gfx/TStellate_CT1_F0Response.png" ans =
# #  "gfx/TStellate_CT1_F0Response.png"
# # #+end_src


# # **** Chopper Transient 2 model: High Freq (12.9 kHz)

# # #+name: TStellate_CT2_F0Response
# # #+begin_src octave :exports none :results file
# # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CT2/F0Response/"
# # for ii = 0:5 vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]); ray =
# # load([datapath "rayltest." num2str(ii) ".dat"]); significant = ray > 5.991; z0 =
# # significant .* vs; subplot(3,2,ii+1) imagesc([0:99],0:5:70,z0', [0
# # 1]);axis("xy"); shading interp; end

# # # xlim([30 60]);
# #  set( get(gcf,'children')(2),"xlabel" ," Channel No.", "ylabel", " Level (dB
# #  SPL)" )

# #  print -dpng "gfx/TStellate_CT2_F0Response.png" ans =
# #  "gfx/TStellate_CT2_F0Response.png"
# # #+end_src




# # \clearpage

# # ** Modulation Transfer Function

# # *** MTF example
# # # # +name: MTF_example
# # # #+begin_src octave :exports none :results file
# # # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/";
# # # addpath(' /octave/freezeColors/');    # grab freezeColors
# # #  spl = 60
# # #  ii = 4
# # # colormap('hot');cmap = colormap();
# # #  vs = load ([datapath num2str(spl) "/vsSPIKES." num2str(ii) ".dat"]);
# # #  ray = load([datapath num2str(spl) "/rayltest." num2str(ii) ".dat"]);
# # #  maskray1 = (13.816- 9.210) * (ray > 13.816) + (9.210-5.991) * (ray > 9.210) + 5.991*(ray > 5.991);
# # #  maskray = (13.816) * (ray > 13.816);

# # # ii=5
# # #  vsP = load ([datapath num2str(spl) "/vsSPIKES." num2str(ii) ".dat"]);
# # #  rayP = load([datapath num2str(spl) "/rayltest." num2str(ii) ".dat"]);
# # #  maskrayP = (13.816-5.991) * (rayP > 13.816) + 5.991*(rayP > 5.991);
# # #  significant = ray > 13.816; # 5.991; # for alpha = 0.05, for alpha=0.01 use rayleigh test > 13.816
# # #  significantP = rayP > 5.991;
# # # # see http://www.neurophys.wisc.edu/comp/docs/not011/not011.html
# # #  z0 = significant .* vs;
# # # z1 = significantP .* vsP;

# # # ## Plot 1
# # # colormap('jet');
# # # subplot(2,4,1);
# # # surf(50:50:1200,1:100,vs,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log","xlim", [50   1200],"ylim",[0   100],"zlim",[0   1],"clim",[0   1]);
# # # view(2);
# # #  colorbar ("SouthOutside");
# # # text (200, 110, "R","fontname","Helvetica","fontsize",16);
# # # text (10, 50, "HSR","fontname","Helvetica","fontsize",16);
# # # freezeColors;

# # # ## Plot 2
# # # subplot(2,4,2)
# # # colormap(cmap(64:-1:1,:));
# # # surf(50:50:1200,1:100,ray,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')

# # # # contourf(50:50:1200,1:100,rayP,[5.991 13.816])

# # # # surf(50:50:1200,1:100,ray,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100]);
# # # view(2);
# # # colorbar ("SouthOutside");
# # # text (50, 110, "Rayleigh Test","fontname","Helvetica","fontsize",16);
# # # freezeColors;

# # # ## Plot 3
# # # subplot(2,4,3);
# # # colormap(cmap(64:-1:1,:));
# # # surf(50:50:1200,1:100,maskray1,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100]);
# # # view(2);
# # # colorbar ("SouthOutside");
# # # text (120, 110, "Mask","fontname","Helvetica","fontsize",16);

# # # freezeColors;

# # # ## Plot 4
# # # subplot(2,4,4)
# # # colormap('jet');
# # # surf(50:50:1200,1:100,z0,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100],"zlim",[0   1],"clim",[0   1]);
# # # view(2);
# # # colorbar ("SouthOutside")
# # # text (100, 110, "R .* Mask","fontname","Helvetica","fontsize",16)


# # # # subplot(2,4,5)

# # # # surf(50:50:1200,1:100,vsP,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # # "xlim", [50   1200],"ylim",[0   100],"zlim",[0   1],"clim",[0   1]);
# # # # view(2);
# # # # # colorbar ("SouthOutside")
# # # # # text (200, 110, "R","fontname","Helvetica","fontsize",16)
# # # # text (10, 50, "LSR","fontname","Helvetica","fontsize",16);

# # # # subplot(2,4,6)
# # # # surf(50:50:1200,1:100,rayP,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # # # contourf(50:50:1200,1:100,rayP,[5.991 13.816])

# # # # # surf(50:50:1200,1:100,ray,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # # "xlim", [50   1200],"ylim",[0   100]);
# # # # view(2);
# # # # #colorbar ("SouthOutside")
# # # # #text (50, 110, "Rayleigh Test","fontname","Helvetica","fontsize",16)

# # # # subplot(2,4,7);
# # # # surf(50:50:1200,1:100,maskrayP,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # # "xlim", [50   1200],"ylim",[0   100]);
# # # # view(2);
# # # # #text (120, 110, "Mask","fontname","Helvetica","fontsize",16)

# # # # subplot(2,4,8)
# # # # surf(50:50:1200,1:100,z1,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # # "xlim", [50   1200],"ylim",[0  100],"zlim", [0   1],"clim",[0  1]);
# # # # view(2);
# # # # #colorbar ("SouthOutside")

# # # # #text (100, 110, "R .* Mask","fontname","Helvetica","fontsize",16)


# # # %axis("xy")
# # # # set( get(gcf,'children')(6)),"xlabel"," Mod Freq ","ylabel"," Channel No. ", )

# # #  print -dpng "gfx/MTF_example.png"
# # #  ans = "gfx/MTF_example.png"
# # # #+end_src

# # *** MTF example2
# # # # +name: MTF_example2
# # # #+begin_src gnuplot :exports none :file ./gfx/MTF_example2.png :term pngcairo size 700,524 enhanced font 'Verdana,10'
# # # # :file ./gfx/MTF_example.eps :term postscript eps size 3.5,2.62 enhanced defaultplex leveldefault colour solid dashlength 1.0 linewidth 2.0 butt noclip  palfuncparam 2000,0.003  "Helvetica" 18
# # #   reset
# # #   load "/media/data/Work/cnstellate/ResponsesNoComp/default.gnu"
  
# # #   #  set terminal postscript eps size 3.5,2.62 enhanced defaultplex \
# # #   #     leveldefault mono \
# # #   #     solid dashlength 1.0 linewidth 2.0 butt noclip \
# # #   #     palfuncparam 2000,0.003 \
# # #   #     "Helvetica" 18
# # #   # set output  "gfx/MTF_example.eps"
  
# # #   # set term pngcairo
# # #   # set output "gfx/MTF_example.png"
# # #   # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/"
# # #   # spl = 60
# # #   # ii = 4
  
# # #   # vs = "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.4.dat"
# # #   # ray = "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/rayltest.4.dat"
# # #    maskray1(r) = (13.816- 9.210) * (r > 13.816) + (9.210-5.991) * (r > 9.210) + 5.991*(r > 5.991)
# # #   # maskray(ray) = (13.816) * (ray > 13.816);
  
# # #    significant(r) = r > 5.991 ? r : 0
# # #   # 5.991 # for alpha = 0.05, for alpha=0.01 use rayleigh test > 13.816
# # #   # see http://www.neurophys.wisc.edu/comp/docs/not011/not011.html
# # #   # z0 = significant .* vs;
  
# # #   set multiplot layout 1,4
# # #   ## Plot 1
# # #   set pm3d map
# # #   set palette @JET
# # #   set xrange [50:800]
# # #   set logscale x 10
# # #   set yrange [0:99]
# # #   set zrange [0:1]
# # #   set cbrange [0:1]
# # #   set xtics nomirror out
# # #   set ytics nomirror out
# # #   set label 1 "R" at 200, 110 font "Helvetica,16"
# # #   set label 2 "HSR" at 10, 50 font "Helvetica,16"
# # #   splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:3
# # #   #splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.0.dat" matrix using ($1*50):2:3
  
# # #   unset label 1
# # #   unset label 2
# # #   set palette @IHOT
# # #   set label 1 "Rayleigh Test" at 50, 110 ,font "Helvetica,16"
# # #   splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/rayltest.4.dat" matrix using ($1*50):2:3
# # #   #splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/rayltest.0.dat" matrix using ($1*50):2:3
  
  
# # #   set label 1 "Mask" at 50, 110  font "Helvetica,16"
# # #   splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/rayltest.4.dat" matrix using ($1*50):2:(maskray1($3))
# # #   #splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/rayltest.0.dat" matrix using ($1*50):2:(maskray1($3))
  
  
# # #   set label 1 "R .* Mask" at 100, 110 font "Helvetica,16"
# # #   set palette @JET
# # #   splot "/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:(significant($3))
# # #   #splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.0.dat" matrix using ($1*50):2:(significant($3))
  
# # # #+end_src

# # *** MTF atCF gnuplot

# # # #+name: MTF_atCF_gnu
# # # #+begin_src gnuplot :exports none :file ./gfx/MTF_atCF.png :term pngcairo size 350,262 enhanced font 'Verdana,10'
# # #   #.eps :term post eps size 3.5,2.62 enh color solid dashlength 1.0 linewidth 2.0 butt noclip palfuncparam 2000,0.003 "Helvetica" 12
# # #     reset
# # #     load "/media/data/Work/cnstellate/ResponsesNoComp/default.gnu"
    
# # #     # set terminal postscript eps size 3.5,2.62 enhanced defaultplex \
# # #     #    leveldefault mono \
# # #     #    solid dashlength 1.0 linewidth 2.0 butt noclip \
# # #     #    palfuncparam 2000,0.003 \
# # #     #    "Helvetica" 18
# # #     # set output  "gfx/MTF_example.eps"
# # #     # set term pngcairo
# # #     # set output "gfx/MTF_atCF.png"
    
# # #      set multiplot layout 2,1
# # #        set xlabel 'f_m (Hz)'
       
# # #        set ylabel 'R'
# # #        plot [*:*][0:1] "< ls -tr /media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/*/vsSPIKES.0.dat | xargs awk '/^50\t/ {print $2}' " using ($0*50):1
# # #        set pm3d map
# # #        set palette @JET
# # #        set ylabel 'Channel No.'
# # #        splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:3
    
# # # #+end_src

# # *** MTF at CF

# # # #+name: MTF_atCF
# # # #+begin_src octave :exports none :results file
# # # datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/F0Response/";
# # #  ii = 4
# # #  vs = load([datapath "vsSPIKES." num2str(ii) ".dat"]);
# # #  ray = load([datapath "rayltest." num2str(ii) ".dat"]);
# # #  significant = ray > 5.991;
# # #  z0 = significant .* vs;
# # #  subplot(3,2,ii+1)
# # #  imagesc([0:99],0:5:70,z0', [0 1]);
# # #  axis("xy")

# # # # xlim([30 60]);
# # #  set( get(gcf,'children')(2),"xlabel" ," Channel No.", "ylabel",  " Level (dB SPL)" )

# # #  vs = load ([datapath num2str(spl) "/vsSPIKES." num2str(ii) ".dat"]);
# # #  ray = load([datapath num2str(spl) "/rayltest." num2str(ii) ".dat"]);
# # #  maskray1 = (13.816-5.991) * (ray > 13.816) + 5.991*(ray > 5.991);
# # #  maskray = (13.816) * (ray > 13.816);

# # # ii=5
# # #  vsP = load ([datapath num2str(spl) "/vsSPIKES." num2str(ii) ".dat"]);
# # #  rayP = load([datapath num2str(spl) "/rayltest." num2str(ii) ".dat"]);
# # #  maskrayP = (13.816-5.991) * (rayP > 13.816) + 5.991*(rayP > 5.991);
# # #  significant = ray > 13.816; # 5.991; # for alpha = 0.05, for alpha=0.01 use rayleigh test > 13.816
# # #  significantP = rayP > 5.991;
# # # # see http://www.neurophys.wisc.edu/comp/docs/not011/not011.html
# # #  z0 = significant .* vs;
# # # z1 = significantP .* vsP;
# # #  subplot(2,4,1);
# # # % imagesc(z0, [0 1]);

# # # surf(50:50:1200,1:100,vs,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log","xlim", [50   1200],"ylim",[0   100],"zlim",[0   1],"clim",[0   1]);
# # # view(2);
# # #  colorbar ("SouthOutside");
# # # text (200, 110, "R","fontname","Helvetica","fontsize",16);
# # # text (10, 50, "HSR","fontname","Helvetica","fontsize",16);

# # # subplot(2,4,2);
# # # surf(50:50:1200,1:100,ray,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')

# # # # contourf(50:50:1200,1:100,rayP,[5.991 13.816])

# # # # surf(50:50:1200,1:100,ray,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100]);
# # # view(2);
# # # colorbar ("SouthOutside");
# # # text (50, 110, "Rayleigh Test","fontname","Helvetica","fontsize",16);

# # # subplot(2,4,3);
# # # surf(50:50:1200,1:100,maskray1,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100]);
# # # view(2);
# # # colorbar ("SouthOutside");
# # # text (120, 110, "Mask","fontname","Helvetica","fontsize",16);

# # # subplot(2,4,4)
# # # surf(50:50:1200,1:100,z0,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100],"zlim",[0   1],"clim",[0   1]);
# # # view(2);
# # # colorbar ("SouthOutside")
# # # text (100, 110, "R .* Mask","fontname","Helvetica","fontsize",16)


# # # subplot(2,4,5)

# # # surf(50:50:1200,1:100,vsP,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100],"zlim",[0   1],"clim",[0   1]);
# # # view(2);
# # # # colorbar ("SouthOutside")
# # # # text (200, 110, "R","fontname","Helvetica","fontsize",16)
# # # text (10, 50, "LSR","fontname","Helvetica","fontsize",16);

# # # subplot(2,4,6)
# # # surf(50:50:1200,1:100,rayP,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # # contourf(50:50:1200,1:100,rayP,[5.991 13.816])

# # # # surf(50:50:1200,1:100,ray,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100]);
# # # view(2);
# # # #colorbar ("SouthOutside")
# # # #text (50, 110, "Rayleigh Test","fontname","Helvetica","fontsize",16)

# # # subplot(2,4,7);
# # # surf(50:50:1200,1:100,maskrayP,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0   100]);
# # # view(2);
# # # #text (120, 110, "Mask","fontname","Helvetica","fontsize",16)

# # # subplot(2,4,8)
# # # surf(50:50:1200,1:100,z1,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# # # set(gca,"TickDir","out","XTick",[50 100:100:1200], "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \
# # # "xlim", [50   1200],"ylim",[0  100],"zlim", [0   1],"clim",[0  1]);
# # # view(2);
# # # #colorbar ("SouthOutside")

# # # #text (100, 110, "R .* Mask","fontname","Helvetica","fontsize",16)

# # # %axis("xy")
# # # set( get(gcf,'children')(6)),"xlabel"," Mod Freq ","ylabel"," Channel No. ", )

# # #  print -dpng "gfx/MTF_atCF.png"
# # #  ans = "gfx/MTF_atCF.png"
# # # #+end_src

# # *** MTF example3 
# # # # +name MTF_example3
# # # #+begin_src gnuplot :exports none :file ./gfx/MTF_example3.png  :term pngcairo size 700,524 enhanced font 'Verdana,10'
# # # :file ./gfx/MTF_example3.eps :term post eps size 7.00,5.24 enh color solid dashlength 1.0 linewidth 2.0 butt noclip palfuncparam 2000,0.003 "Helvetica" 12# 
# # #   reset
# # #   load '/media/data/cnstellate/ResponsesNoComp/default.gnu'
  
# # #   # set term pngcairo size 350,262 enhanced font 'Verdana,10'
# # #   # set output "gfx/MTF_example.png"
  
# # #   # Margins for each row resp. column
# # #   TMARGIN = "set tmargin at screen 0.90; set bmargin at screen 0.55"
# # #   R2MARGIN = "set tmargin at screen 0.90; set bmargin at screen 0.55"
  
# # #   BMARGIN = "set tmargin at screen 0.55; set bmargin at screen 0.20"
# # #   LMARGIN = "set lmargin at screen 0.15; set rmargin at screen 0.55"
# # #   RMARGIN = "set lmargin at screen 0.55; set rmargin at screen 0.95"

# # #   set autoscale 
# # #   set zrange [0:1]
# # #   set cbrange [0:1]
# # #   set tics scale 0.5
# # #   set logscale x 10
# # #   unset colorbox
# # #   # Placement of the a,b,c,d labels in the graphs
# # #   POS = "at graph 0.92,0.9 font 'Helvetica,18' front "
# # #   unset key

# # #   # x- and ytics for each row resp. column
# # #   NOXTICS = "set xtics out ('' 100,'' 200,'' 300,'' 400,'' 500,'' 600,'' 700,'' 800); \
# # #             unset xlabel"
# # #   XTICS = "set xtics border out ('100' 100,'' 200,'300' 300,'' 400,'' 500,'' 600,'' 700,'800' 800);\
# # #             set xlabel 'f_m (Hz)'"
# # #   NOYTICS = "unset ytics; unset ylabel"
# # #   YTICS = "set ytics border out 0,20,100; set ylabel 'Channel No.'"
  
# # #   set multiplot layout 2,2 rowsfirst
# # #   set pm3d map
# # #   set palette @JET
# # #   # --- GRAPH a
# # #   @NOXTICS; @YTICS
# # #   @TMARGIN; @LMARGIN
# # #   set label 1 'a' @POS
# # #   splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.4.dat" matrix using ($1*50):2:3
  
# # #   # --- GRAPH b
# # #   @NOXTICS; @NOYTICS
# # #   @TMARGIN; @RMARGIN
# # #   set label 1 'b' @POS
# # #   splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.1.dat" matrix using ($1*50):2:3
  
# # #   # --- GRAPH c
# # #   @XTICS; @YTICS
# # #   @BMARGIN; @LMARGIN
# # #   set label 1 'c' @POS
# # #   splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.0.dat" matrix using ($1*50):2:3
# # #   set colorbox
# # #   set cbtics ('0' 0,'0.2' 0.2,'0.4' 0.4,'0.6' 0.6,'0.8' 0.8,'1.0' 1)
# # #   # --- GRAPH d
# # #   @XTICS; @NOYTICS
# # #   @BMARGIN; @RMARGIN
# # #   set label 1 'd' @POS
# # #   splot "/media/data/Work/cnstellate/ResponsesNoComp/ModulationTransferFunction/60/vsSPIKES.2.dat" matrix using ($1*50):2:3
  
# # #   unset multiplot
# # # #+END_SRC

# *** Octave versions

# #+name: TStellate_CS_MTF
# #+begin_src octave :exports none :results file
# datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/";
# ha = tight_subplot(4,6,[.01 .01],[0.01 0.01],[0.01 .01])

# for spl = 20:20:80 for ii = 0:5

#  vs = load ([datapath num2str(spl) "/vsSPIKES." num2str(ii) ".dat"]); ray =
#  load([datapath num2str(spl) "/rayltest." num2str(ii) ".dat"]); % vs = load
#  ([datapath num2str(spl) "/vsPSTH." num2str(ii) ".dat"]); % ray = load([datapath
#  num2str(spl) "/rayltestPSTH." num2str(ii) ".dat"]);

#  significant = ray > 5.991; # for alpha = 0.05, for alpha=0.01 use rayleigh test
#  > 13.816
# # see http://www.neurophys.wisc.edu/comp/docs/not011/not011.html
#  z0 = significant .* vs;
# # subplot(4,6,((spl/20)-1)*6 + (ii+1));
# axes(ha(((spl/20)-1)*6 + (ii+1)));

# surf(50:50:1200,1:100,z0,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# set(gca,"TickDir","out","XTick",[50 100:100:1200],
# "XTickLabel",{},"YTick",[0:25:100], "YTickLabel",{},"XScale","log", \ "xlim",
# [50 1200],"ylim",[0 100],"zlim",[0 1],"clim",[0 1]); view(2);

# %axis("xy") end; end;

# # set( get(gcf,'children')(6)),"xlabel"," Mod Freq ","ylabel"," Channel No. ", )

#  print -dpng "gfx/TStellate_CS_MTF.png" ans = "gfx/TStellate_CS_MTF.png"
# #+end_src

# #+CAPTION:  MTF of the 6 units at 20 db SPL (top), 40 dB, 60 dB, and 80 dB (bottom). Low freq $f_m$ (3.9 kHz) and CS optimised parameters for the TS model.
# #+ATTR_LaTeX: width=0.9\linewidth
# #+LABEL: fig:CSMTF
# [[file:./gfx/TStellate_CS_MTF.png]]



# #+name: TStellate_CT1_MTF
# #+begin_src octave :exports none :results file
# datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CT1/ModulationTransferFunction/";

# ha = tight_subplot(4,6,[.01 .01],[0.01 0.01],[0.01 .01]) for spl = 20:20:80 for
# ii = 0:5

#  vs = load ([datapath num2str(spl) "/vsSPIKES." num2str(ii) ".dat"]); ray =
#  load([datapath num2str(spl) "/rayltest." num2str(ii) ".dat"]); % vs = load
#  ([datapath num2str(spl) "/vsPSTH." num2str(ii) ".dat"]); % ray = load([datapath
#  num2str(spl) "/rayltestPSTH." num2str(ii) ".dat"]); significant = ray >
#  5.991; # for alpha = 0.05, for alpha=0.01 use rayleigh test > 13.816
# # see http://www.neurophys.wisc.edu/comp/docs/not011/not011.html
#  z0 = significant .* vs;
# # subplot(4,6,((spl/20)-1)*6 + (ii+1));
# axes(ha(((spl/20)-1)*6 + (ii+1)));

# surf(50:50:1200,1:100,z0,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# set(gca,"TickDir","out","XTick",[50 100:100:1200],
# "XTickLabel",{},"YTick",[0:20:100], "YTickLabel",{},"XScale","log", \ "xlim",
# [50 1200],"ylim",[40 90],"zlim",[0 1],"clim",[0 1]); view(2);

# %axis("xy") end; end;

# # set( get(gcf,'children')(6)),"xlabel"," Mod Freq ","ylabel"," Channel No. ", )

#  print -dpng "gfx/TStellate_CT1_MTF.png" ans = "gfx/TStellate_CT1_MTF.png"
# #+end_src

# #+CAPTION:  MTF of the 6 units at 20 db SPL (top), 40 dB, 60 dB, and 80 dB (bottom). Med freq f_m and CT1 model.
# #+ATTR_LaTeX: width=0.9\linewidth
# #+LABEL: fig:CT1MTF
# [[file:./gfx/TStellate_CT1_MTF.png]]


# #+name: TStellate_CT2_MTF
# #+begin_src octave :exports none :results file
# datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CT2/ModulationTransferFunction/";

# ha = tight_subplot(4,6,[.01 .01],[0.01 0.01],[0.01 .01]) for spl = 20:20:80 for
# ii = 0:5

#  vs = load ([datapath num2str(spl) "/vsSPIKES." num2str(ii) ".dat"]); ray =
#  load([datapath num2str(spl) "/rayltest." num2str(ii) ".dat"]);

#  significant = ray > 5.991; # for alpha = 0.05, for alpha=0.01 use rayleigh test
#  > 13.816
# # see http://www.neurophys.wisc.edu/comp/docs/not011/not011.html
#  z0 = significant .* vs;

# # subplot(4,6,((spl/20)-1)*6 + (ii+1));
# axes(ha(((spl/20)-1)*6 + (ii+1)));

# surf(50:50:1200,1:100,z0,"EdgeColor",'none','LineStyle','none','FaceLighting','phong')
# set(gca,"XTickLabel",{},"YTick",[50:10:100], "YTickLabel",{},"XScale","log", \
# "xlim", [50 1200],"ylim",[0 100],"zlim",[0 1],"clim",[0 1]); view(2);


# %axis("xy") end; end;

# set(ha([1:7 12 13 18:24]),"TickDir","out");

# set(ha(19),"xlabel"," Modulation Frequency (Hz) ",
# "fontname","Helvetica","fontsize",20) set(ha(22),"ylabel"," Channel No. ",
# "fontname","Helvetica","fontsize",20)

#  print -r300 -depsc2 "gfx/TStellate_CT2_MTF.eps" ans =
#  "gfx/TStellate_CT2_MTF.png"
# #+end_src

# #+CAPTION:  MTF of the 6 units at 20 db SPL (top), 40 dB, 60 dB, and 80 dB (bottom). High freq f_m and CT2 model.
# #+ATTR_LaTeX: width=0.9\linewidth
# #+LABEL: fig:CT2MTF
# [[file:./gfx/TStellate_CT2_MTF.png]]


# *** Gnuplot versions

# #+name CS_MTF
# #+begin_src gnuplot :exports none :file ./gfx/CS_MTF.png  :term pngcairo size 700,524 enhanced font 'Verdana,10'
#   # :file ./gfx/CS_MTF.eps  :term postscript eps size 7.00,5.24 enhanced defaultplex  leveldefault color  solid dashlength 1.0 linewidth 2.0 butt noclip palfuncparam 2000,0.003 "Helvetica" 12
#     reset
#     ## Keep the figure clean
#       set border 0 # no borders
#       unset key
#       unset xlabel
#       unset ylabel
#       unset xtics
#       unset ytics
#       unset ztics
#       unset colorbox
    
#     ## Apply labels
#     set label 1 "TS" at screen 0.0833, screen 1.1 center font "Helvetica,22" front
#     set label 2 "TV" at screen 0.25, screen 1.1 center font "Helvetica,22" front
#     set label 3 "DS" at screen 0.4166, screen 1.1 center font "Helvetica,22" front
#     set label 4 "GLG" at screen 0.5833, screen 1.1 center font "Helvetica,22" front
#     set label 5 "HSR" at screen 0.75, screen 1.1 center font "Helvetica,22" front
#     set label 6 "LSR" at screen 0.916, screen 1.1 center font "Helvetica,22" front
#     set label 7 "20 dB" at screen 1.1, screen 0.875 left font "Helvetica,22" front
#     set label 8 "40 dB" at screen 1.1, screen 0.625 left font "Helvetica,22" front
#     set label 9 "60 dB" at screen 1.1, screen 0.375 left font "Helvetica,22" front
#     set label 10 "80 dB" at screen 1.1, screen 0.125 left font "Helvetica,22" front
    
#       set multiplot layout 4,6 scale 1.5,1.65
#       set yrange [0:100]
#       set cbrange [0:1]
#       set zrange [0:1]
#       set pm3d map
#       set palette @JET # macro set in $HOME/.gnuplot
#       set logscale x 10
      
#     datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CS/ModulationTransferFunction/";
#     ## 'do' command only valid for gnuplot versions 4.5 or above
#       do for [spl = 20:80:20] {
#         do for [ii = 0:5] {
#          splot      sprintf("%s%d/vsSPIKES.%d.dat",datapath,spl,ii) matrix using      (($1+1)*50):2:3
#         }
#       }
    
#     unset multiplot
#   #  !fixbb 'gfx/CS_MTF.eps' && convert -density 300 './gfx/CS_MTF.eps' './gfx/CS_MTF.png'
# #+END_SRC


# #+name CT1_MTF
# #+begin_src gnuplot :exports none :file ./gfx/CT1_MTF.png  :term pngcairo size 700,524 enhanced font 'Verdana,10'
#   # :file ./gfx/CT1_MTF.eps  :term postscript eps size 7.00,5.24 enhanced defaultplex  leveldefault color  solid dashlength 1.0 linewidth 2.0 butt noclip palfuncparam 2000,0.003 "Helvetica" 12
#     reset
#     ## Keep the figure clean
#       set border 0 # no borders unset key unset xlabel unset ylabel unset xtics
#       unset ytics
#       unset ztics
#       unset colorbox
    
#     ## Apply labels
#     set label 1 "TS" at screen 0.0833, screen 1.1 center font "Helvetica,22" front
#     set label 2 "TV" at screen 0.25, screen 1.1 center font "Helvetica,22" front
#     set label 3 "DS" at screen 0.4166, screen 1.1 center font "Helvetica,22" front
#     set label 4 "GLG" at screen 0.5833, screen 1.1 center font "Helvetica,22" front
#     set label 5 "HSR" at screen 0.75, screen 1.1 center font "Helvetica,22" front
#     set label 6 "LSR" at screen 0.916, screen 1.1 center font "Helvetica,22" front
#     set label 7 "20 dB" at screen 1.1, screen 0.875 left font "Helvetica,22" front
#     set label 8 "40 dB" at screen 1.1, screen 0.625 left font "Helvetica,22" front
#     set label 9 "60 dB" at screen 1.1, screen 0.375 left font "Helvetica,22" front
#     set label 10 "80 dB" at screen 1.1, screen 0.125 left font "Helvetica,22" front
    
#     set multiplot layout 4,6 scale 1.5,1.65
  
  
#     set yrange [0:100]
#     set cbrange [0:1]
  
#     set zrange [0:1]
#     set pm3d map
#     set palette @JET # macro
#     set in $HOME/.gnuplot
  
#     set logscale x 10
      
#     datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CT1/ModulationTransferFunction/";
#     ## 'do' command only valid for gnuplot versions 4.5 or above
#     do for [spl = 20:80:20] {
#     do for [ii = 0:5] {
#     splot      sprintf("%s%d/vsSPIKES.%d.dat",datapath,spl,ii) matrix using      (($1+1)*50):2:3 }
#     }
    
#     unset multiplot
#   #  !fixbb 'gfx/CT1_MTF.eps' && convert -density 300 './gfx/CT1_MTF.eps' './gfx/CT1_MTF.png'
# #+END_SRC

# #+RESULTS:
# [[file:./gfx/CT1_MTF.png]]


# #+name CT2_MTF
# #+begin_src gnuplot :exports none :file ./gfx/CT2_MTF.png  :term pngcairo size 700,524 enhanced font 'Verdana,10' 
#   # :file ./gfx/CT2_MTF.eps  :term postscript eps size 7.00,5.24 enhanced defaultplex  leveldefault color  solid dashlength 1.0 linewidth 2.0 butt noclip palfuncparam 2000,0.003 "Helvetica" 12
#     reset
#     ## Keep the figure clean
#       set border 0 # no borders unset key unset xlabel unset ylabel unset xtics
#       unset ytics
#       unset ztics
#       unset colorbox
    
#     ## Apply labels
#     set label 1 "TS" at screen 0.0833, screen 1.1 center font "Helvetica,22" front
#     set label 2 "TV" at screen 0.25, screen 1.1 center font "Helvetica,22" front
#     set label 3 "DS" at screen 0.4166, screen 1.1 center font "Helvetica,22" front
#     set label 4 "GLG" at screen 0.5833, screen 1.1 center font "Helvetica,22" front
#     set label 5 "HSR" at screen 0.75, screen 1.1 center font "Helvetica,22" front
#     set label 6 "LSR" at screen 0.916, screen 1.1 center font "Helvetica,22" front
#     set label 7 "20 dB" at screen 1.1, screen 0.875 left font "Helvetica,22" front
#     set label 8 "40 dB" at screen 1.1, screen 0.625 left font "Helvetica,22" front
#     set label 9 "60 dB" at screen 1.1, screen 0.375 left font "Helvetica,22" front
#     set label 10 "80 dB" at screen 1.1, screen 0.125 left font "Helvetica,22" front
    
#     set multiplot layout 4,6 scale 1.5,1.3
#     set yrange [0:100]
#     set cbrange [0:1]
#     set zrange [0:1]
#     set pm3d map
#     set palette @JET # macro set in $HOME/.gnuplot
#     set logscale x 10
      
#     datapath="/media/c4bb64a6-7c5f-4dc1-9965-b0f4c1117b36/Work-archive/cnstellate-03-Feb-2012/TStellate_CT2/ModulationTransferFunction/";
#     ## 'do' command only valid for gnuplot versions 4.5 or above
#     do for [spl = 20:80:20] { do for [ii = 0:5] {
#        splot sprintf("%s%d/vsSPIKES.%d.dat",datapath,spl,ii) matrix using (($1+1)*50):2:3 }
#     }
#       unset multiplot
#   #  !fixbb 'gfx/CT2_MTF.eps' && convert -density 300 './gfx/CT2_MTF.eps' './gfx/CT2_MTF.png'
# #+END_SRC




